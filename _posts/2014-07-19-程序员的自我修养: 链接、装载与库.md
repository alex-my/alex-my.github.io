---
layout: post
title: '程序员的自我修养: 链接、装载与库'
date: 2014-07-19 21:25:00 +0800
categories: ['读书', '编程']
author: Alex
---

## 1.6.2 线程安全

1. 编译为汇编代码后，单指令的操作成为原子的。

2. 同步与锁。
   二元信号量，多元信号量，互斥量，临界区。其它包括读写锁，条件变量。

   - 二元信号量，适合与只能被一个线程独占访问的资源。当二元信号量处于非占用状态时，第一个试图获取该二元信号量的线程会获得该锁，并将二元信号量重置为占用状态，在未释放该锁前，其它所有试图获取该二元信号量的线程将会等待。

   - 多元信号量，简称信号量。一个初始值为 N 的信号量允许 N 个线程并发访问。
     获取该信号量时，信号量的值减一，当信号量的值小于 0 时，再来获取信号量的线程进入等待状态。
     释放该信号量时，信号量的值加一，当信号量的值大于 0 时，唤醒一个处于等待中的线程。

   - 互斥量，与二元信号量类似，资源同时仅允许一个线程访问，但不同之处的是，`信号量在整个系统内可以被任意线程获取，释放。即信号量可以被线程A获取，再由线程B释放。而互斥量要求那个线程获取，哪个线程就要负责释放这个锁，其它线程去释放是无效的`。

   - 临界区，比互斥量更加严格的同步手段。`临界区与信号量，互斥量不同之处在于，信号量和互斥量在系统的任何进程中都是可见的，一个进程创建了互斥量，其它进程来获取该锁是合法的。临界区的作用范围仅限于本进程`。除此之外，互斥量和临界区具有相同的性质。

   - `使用互斥量不仅能够在同一应用程序不同线程中实现资源的安全共享，而且可以在不同应用程序的线程之间实现对资源的安全共享`。

## 7.1 使用动态链接

1. 好处：在内存中共享一个目标文件模块的好处不仅仅是节省内存，它还可以减少物理页面的换入换出，也可以增加 CPU 缓存的命中率，因为不同进程的数据和指令访问都集中在了同一个共享模块上。

2. 劣处: 动态链接把链接这个过程本来应该在程序在程序装载前被推迟到了装载之后。动态链接会导致程序性能的一些损失，但可以进行优化，例如“延迟绑定”。句估算，动态链接和静态链接相比，性能损失约 1%~5%。

3. 延迟绑定：基本思想是当函数第一次被使用时才进行绑定，未使用的函数不进行绑定。
